// ---------------------------------------------------------------------------------------------------------------------

"use strict"

// npm
const bole = require('bole')
const pushid = require('pushid')

// ---------------------------------------------------------------------------------------------------------------------
// setup

const logger = bole('req')

// ---------------------------------------------------------------------------------------------------------------------
// middleware

function context(req, res, next) {
  req._ = req._ || {}
  next()
}

function rid(req, res, next) {
  req._.rid = pushid()
  next()
}

function log(req, res, next) {
  req._.log = logger(req._.rid)
  next()
}

// ---------------------------------------------------------------------------------------------------------------------

module.exports = {
  context,
  rid,
  log,
}

// ---------------------------------------------------------------------------------------------------------------------
